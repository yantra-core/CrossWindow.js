{"version":3,"sourceRoot":"../","sources":["./dist/crosswindow.js"],"sourcesContent":["(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.CW = f()}})(function(){var define,module,exports;return (function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nObject.defineProperty(exports, \"CrossWindow\", {\n  enumerable: true,\n  get: function get() {\n    return _CrossWindow[\"default\"];\n  }\n});\nexports.createCrossWindow = createCrossWindow;\nvar _CrossWindow = _interopRequireDefault(require(\"./lib/CrossWindow.js\"));\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\nfunction createCrossWindow() {\n  var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  return new _CrossWindow[\"default\"](options);\n}\n\n},{\"./lib/CrossWindow.js\":3}],2:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\nfunction _typeof(o) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o; }, _typeof(o); }\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor); } }\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == _typeof(i) ? i : String(i); }\nfunction _toPrimitive(t, r) { if (\"object\" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != _typeof(i)) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nvar CommunicationManager = exports[\"default\"] = /*#__PURE__*/function () {\n  function CommunicationManager(channel, windowId, game, metadataManager) {\n    _classCallCheck(this, CommunicationManager);\n    this.channel = channel;\n    this.windowId = windowId;\n    this.game = game;\n    this.metadataManager = metadataManager;\n    this.events = {};\n    this.setupListeners();\n  }\n  _createClass(CommunicationManager, [{\n    key: \"setupListeners\",\n    value: function setupListeners() {\n      var _this = this;\n      this.channel.onmessage = function (event) {\n        var data = event.data;\n        switch (data.action) {\n          case 'createEntity':\n            if (data.entities) data.entities.forEach(function (entity) {\n              return _this.game.createEntity(entity);\n            });\n            break;\n          case 'ping':\n            if (data.sourceWindowId !== _this.windowId) _this.channel.postMessage({\n              action: 'pong',\n              sourceWindowId: _this.windowId\n            });\n            break;\n          case 'pong':\n            if (data.sourceWindowId !== _this.windowId) _this.metadataManager.markWindowAsActive(data.sourceWindowId);\n            break;\n          case 'sendMessage':\n            if (data.targetWindowId === _this.windowId) _this.emit('message', data);\n            break;\n          case 'intersecting':\n            if (data.sourceWindowId !== _this.windowId) _this.emit('intersecting', data.intersectionArea);\n            break;\n        }\n      };\n    }\n  }, {\n    key: \"sendMessage\",\n    value: function sendMessage(targetWindowId, message) {\n      this.channel.postMessage({\n        action: 'sendMessage',\n        targetWindowId: targetWindowId,\n        payload: message\n      });\n    }\n  }, {\n    key: \"on\",\n    value: function on(eventName, callback) {\n      if (!this.events[eventName]) this.events[eventName] = [];\n      this.events[eventName].push(callback);\n    }\n  }, {\n    key: \"emit\",\n    value: function emit(eventName, data) {\n      var callbacks = this.events[eventName];\n      if (callbacks) callbacks.forEach(function (callback) {\n        return callback(data);\n      });\n    }\n  }]);\n  return CommunicationManager;\n}();\n\n},{}],3:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\nvar _getBestWindow = _interopRequireDefault(require(\"./getBestWindow.js\"));\nvar _open = _interopRequireDefault(require(\"./open.js\"));\nvar _CommunicationManager = _interopRequireDefault(require(\"./CommunicationManager.js\"));\nvar _MetadataManager = _interopRequireDefault(require(\"./MetadataManager.js\"));\nvar _IntersectionDetector = _interopRequireDefault(require(\"./IntersectionDetector.js\"));\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\nfunction _typeof(o) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o; }, _typeof(o); }\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor); } }\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == _typeof(i) ? i : String(i); }\nfunction _toPrimitive(t, r) { if (\"object\" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != _typeof(i)) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); } // CrossWindow.js - Marak Squires 2024\n// A class to manage communication and entity movement between multiple windows\n// Supports opening new windows, sending messages, and teleporting entities between windows\n// Also supports detecting and handling window intersections\nvar CrossWindow = exports[\"default\"] = /*#__PURE__*/function () {\n  function CrossWindow(game) {\n    var metadataKey = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'windowMetadata';\n    _classCallCheck(this, CrossWindow);\n    this.game = game;\n    this.metadataKey = metadataKey;\n    this.windowId = \"\".concat(Date.now(), \"-\").concat(Math.random().toString(36).substr(2, 9));\n    this.metadataManager = new _MetadataManager[\"default\"](metadataKey, this.windowId);\n    this.communicationManager = new _CommunicationManager[\"default\"](new BroadcastChannel('crosswindow_channel'), this.windowId, game, this.metadataManager);\n    this.intersectionDetector = new _IntersectionDetector[\"default\"](this.metadataManager, this.windowId);\n    this.on = this.communicationManager.on.bind(this.communicationManager);\n    this.emit = this.communicationManager.emit.bind(this.communicationManager);\n    this.open = _open[\"default\"].bind(this);\n    this.getBestWindow = _getBestWindow[\"default\"].bind(this);\n    this.getWindowMetadata = this.metadataManager.getWindowMetadata.bind(this);\n    // this.postMessage = this.communicationManager.sendMessage.bind(this.communicationManager);\n\n    this.registerWindow();\n  }\n  _createClass(CrossWindow, [{\n    key: \"registerWindow\",\n    value: function registerWindow() {\n      this.metadataManager.updateWindowMetadata();\n      this.pingOtherWindows();\n    }\n  }, {\n    key: \"pingOtherWindows\",\n    value: function pingOtherWindows() {\n      var _this = this;\n      var channel = new BroadcastChannel('crosswindow_channel');\n      channel.postMessage({\n        action: 'ping',\n        sourceWindowId: this.windowId\n      });\n      setTimeout(function () {\n        return _this.metadataManager.removeInactiveWindows();\n      }, 5000);\n    }\n  }, {\n    key: \"deregisterWindow\",\n    value: function deregisterWindow() {\n      this.metadataManager.deregisterWindow();\n    }\n  }]);\n  return CrossWindow;\n}();\n\n},{\"./CommunicationManager.js\":2,\"./IntersectionDetector.js\":4,\"./MetadataManager.js\":5,\"./getBestWindow.js\":6,\"./open.js\":7}],4:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\nfunction _typeof(o) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o; }, _typeof(o); }\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }\nfunction _iterableToArrayLimit(r, l) { var t = null == r ? null : \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"]; if (null != t) { var e, n, i, u, a = [], f = !0, o = !1; try { if (i = (t = t.call(r)).next, 0 === l) { if (Object(t) !== t) return; f = !1; } else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0); } catch (r) { o = !0, n = r; } finally { try { if (!f && null != t[\"return\"] && (u = t[\"return\"](), Object(u) !== u)) return; } finally { if (o) throw n; } } return a; } }\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor); } }\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == _typeof(i) ? i : String(i); }\nfunction _toPrimitive(t, r) { if (\"object\" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != _typeof(i)) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nvar IntersectionDetector = exports[\"default\"] = /*#__PURE__*/function () {\n  function IntersectionDetector(metadataManager, windowId) {\n    _classCallCheck(this, IntersectionDetector);\n    this.metadataManager = metadataManager;\n    this.windowId = windowId;\n    this.prevMetadata = null;\n    this.startMetadataPolling();\n  }\n  _createClass(IntersectionDetector, [{\n    key: \"startMetadataPolling\",\n    value: function startMetadataPolling() {\n      var _this = this;\n      this.prevMetadata = this.metadataManager.getWindowMetadata();\n      setInterval(function () {\n        var currentMetadata = _this.metadataManager.getWindowMetadata();\n        if (_this.metadataManager.hasMetadataChanged(_this.prevMetadata, currentMetadata)) {\n          _this.metadataManager.updateWindowMetadata(currentMetadata);\n          _this.checkForIntersections(currentMetadata);\n        }\n      }, 100);\n    }\n  }, {\n    key: \"checkForIntersections\",\n    value: function checkForIntersections(currentMetadata) {\n      var _this2 = this;\n      var allWindowsMetadata = JSON.parse(localStorage.getItem(this.metadataManager.metadataKey)) || {};\n      Object.entries(allWindowsMetadata).forEach(function (_ref) {\n        var _ref2 = _slicedToArray(_ref, 2),\n          windowId = _ref2[0],\n          metadata = _ref2[1];\n        if (windowId !== _this2.windowId && _this2.isOverlapping(currentMetadata, metadata)) {\n          _this2.emitIntersectionEvent(windowId, _this2.calculateIntersection(currentMetadata, metadata));\n        }\n      });\n    }\n  }, {\n    key: \"isOverlapping\",\n    value: function isOverlapping(metadata1, metadata2) {\n      return !(metadata2.position.x >= metadata1.position.x + metadata1.size.width || metadata2.position.x + metadata2.size.width <= metadata1.position.x || metadata2.position.y >= metadata1.position.y + metadata1.size.height || metadata2.position.y + metadata2.size.height <= metadata1.position.y);\n    }\n  }, {\n    key: \"calculateIntersection\",\n    value: function calculateIntersection(metadata1, metadata2) {\n      var x1 = Math.max(metadata1.position.x, metadata2.position.x);\n      var y1 = Math.max(metadata1.position.y, metadata2.position.y);\n      var x2 = Math.min(metadata1.position.x + metadata1.size.width, metadata2.position.x + metadata2.size.width);\n      var y2 = Math.min(metadata1.position.y + metadata1.size.height, metadata2.position.y + metadata2.size.height);\n      return {\n        position: {\n          x: x1,\n          y: y1\n        },\n        size: {\n          width: x2 - x1,\n          height: y2 - y1\n        }\n      };\n    }\n  }, {\n    key: \"emitIntersectionEvent\",\n    value: function emitIntersectionEvent(targetWindowId, intersectionArea) {\n      var channel = new BroadcastChannel('crosswindow_channel');\n      channel.postMessage({\n        action: 'intersecting',\n        sourceWindowId: this.windowId,\n        targetWindowId: targetWindowId,\n        intersectionArea: intersectionArea\n      });\n    }\n  }]);\n  return IntersectionDetector;\n}();\n\n},{}],5:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\nfunction _typeof(o) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o; }, _typeof(o); }\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }\nfunction _iterableToArrayLimit(r, l) { var t = null == r ? null : \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"]; if (null != t) { var e, n, i, u, a = [], f = !0, o = !1; try { if (i = (t = t.call(r)).next, 0 === l) { if (Object(t) !== t) return; f = !1; } else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0); } catch (r) { o = !0, n = r; } finally { try { if (!f && null != t[\"return\"] && (u = t[\"return\"](), Object(u) !== u)) return; } finally { if (o) throw n; } } return a; } }\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor); } }\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == _typeof(i) ? i : String(i); }\nfunction _toPrimitive(t, r) { if (\"object\" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != _typeof(i)) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nvar MetadataManager = exports[\"default\"] = /*#__PURE__*/function () {\n  function MetadataManager(metadataKey, windowId) {\n    _classCallCheck(this, MetadataManager);\n    this.metadataKey = metadataKey;\n    this.windowId = windowId;\n  }\n  _createClass(MetadataManager, [{\n    key: \"getWindowMetadata\",\n    value: function getWindowMetadata() {\n      return {\n        position: {\n          x: window.screenX,\n          y: window.screenY\n        },\n        size: {\n          width: window.innerWidth,\n          height: window.innerHeight\n        }\n      };\n    }\n  }, {\n    key: \"updateWindowMetadata\",\n    value: function updateWindowMetadata() {\n      var metadata = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.getWindowMetadata();\n      var allWindowsMetadata = JSON.parse(localStorage.getItem(this.metadataKey)) || {};\n      allWindowsMetadata[this.windowId] = _objectSpread(_objectSpread({}, metadata), {}, {\n        lastActive: Date.now()\n      });\n      localStorage.setItem(this.metadataKey, JSON.stringify(allWindowsMetadata));\n    }\n  }, {\n    key: \"hasMetadataChanged\",\n    value: function hasMetadataChanged(prevMetadata, currentMetadata) {\n      return prevMetadata.position.x !== currentMetadata.position.x || prevMetadata.position.y !== currentMetadata.position.y || prevMetadata.size.width !== currentMetadata.size.width || prevMetadata.size.height !== currentMetadata.size.height;\n    }\n  }, {\n    key: \"removeInactiveWindows\",\n    value: function removeInactiveWindows() {\n      var timeout = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 5000;\n      var allWindowsMetadata = JSON.parse(localStorage.getItem(this.metadataKey)) || {};\n      var currentTime = Date.now();\n      Object.entries(allWindowsMetadata).forEach(function (_ref) {\n        var _ref2 = _slicedToArray(_ref, 2),\n          windowId = _ref2[0],\n          metadata = _ref2[1];\n        if (currentTime - metadata.lastActive > timeout) {\n          delete allWindowsMetadata[windowId];\n        }\n      });\n      localStorage.setItem(this.metadataKey, JSON.stringify(allWindowsMetadata));\n    }\n  }, {\n    key: \"markWindowAsActive\",\n    value: function markWindowAsActive(windowId) {\n      var allWindowsMetadata = JSON.parse(localStorage.getItem(this.metadataKey)) || {};\n      if (allWindowsMetadata[windowId]) {\n        allWindowsMetadata[windowId].lastActive = Date.now();\n        localStorage.setItem(this.metadataKey, JSON.stringify(allWindowsMetadata));\n      }\n    }\n  }, {\n    key: \"deregisterWindow\",\n    value: function deregisterWindow() {\n      var allWindowsMetadata = JSON.parse(localStorage.getItem(this.metadataKey)) || {};\n      delete allWindowsMetadata[this.windowId];\n      localStorage.setItem(this.metadataKey, JSON.stringify(allWindowsMetadata));\n    }\n  }]);\n  return MetadataManager;\n}();\n\n},{}],6:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = getBestWindow;\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }\nfunction _iterableToArrayLimit(r, l) { var t = null == r ? null : \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"]; if (null != t) { var e, n, i, u, a = [], f = !0, o = !1; try { if (i = (t = t.call(r)).next, 0 === l) { if (Object(t) !== t) return; f = !1; } else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0); } catch (r) { o = !0, n = r; } finally { try { if (!f && null != t[\"return\"] && (u = t[\"return\"](), Object(u) !== u)) return; } finally { if (o) throw n; } } return a; } }\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\nfunction calculateEntryPosition(direction, position) {\n  // TODO: Implement logic to calculate the entry position based on the exit direction and position\n  position.x = -100;\n  position.y = 0;\n  return position;\n}\nfunction calculateDistance(point1, point2) {\n  var dx = point1.x - point2.x;\n  var dy = point1.y - point2.y;\n  return Math.sqrt(dx * dx + dy * dy);\n}\nfunction determineCardinalDirection(screenPosition) {\n  // Use the screenPosition to determine the cardinal direction\n  // This could be a simple check of x and y coordinates relative to the center of the screen\n  var centerX = window.innerWidth / 2;\n  var centerY = window.innerHeight / 2;\n  if (screenPosition.x < centerX && screenPosition.y < centerY) return 'NW';\n  if (screenPosition.x >= centerX && screenPosition.y < centerY) return 'NE';\n  if (screenPosition.x >= centerX && screenPosition.y >= centerY) return 'SE';\n  if (screenPosition.x < centerX && screenPosition.y >= centerY) return 'SW';\n  // Add more granular direction checks if needed\n}\nfunction getBestWindow(entityData) {\n  var _this = this;\n  var direction = determineCardinalDirection(entityData.screenPosition);\n  var allWindowsMetadata = JSON.parse(localStorage.getItem(this.metadataKey)) || {};\n  console.log('getBestWindowgetBestWindow', entityData, direction, allWindowsMetadata, this.windowId);\n  if (Object.keys(allWindowsMetadata).length === 0) {\n    //alert('no other windows found');\n    game.flashMessage('no other windows found');\n  }\n  var bestWindowId = null;\n  var minDistance = Infinity;\n  //game.flashMessage(Object.keys(allWindowsMetadata).length)\n  Object.entries(allWindowsMetadata).forEach(function (_ref) {\n    var _ref2 = _slicedToArray(_ref, 2),\n      windowId = _ref2[0],\n      metadata = _ref2[1];\n    bestWindowId = windowId; // for now\n    if (windowId !== _this.windowId) {\n      // Skip the current window\n      var distance = calculateDistance(entityData.screenPosition, metadata.position);\n      if (distance < minDistance) {\n        minDistance = distance;\n        bestWindowId = windowId;\n      }\n    }\n  });\n  if (bestWindowId) {\n    // Return a window object with a .postMessage() method for the existing best window\n    return {\n      postMessage: function postMessage(data) {\n        console.log('calling internal bestWindow.postMessage', bestWindowId, data);\n\n        // Calculate the entry position based on the exit direction and position\n        var newEntryPosition = calculateEntryPosition(direction, data.position);\n        data.position = newEntryPosition;\n        console.log(\"SENDING NEW POST\", data);\n        _this.communicationManager.sendMessage(bestWindowId, data);\n        /*\n        this.communicationManager.channel.postMessage({\n          action: 'sendMessage',\n          targetWindowId: bestWindowId,\n          payload: data\n        });\n        */\n      }\n    };\n  } else {\n    game.flashMessage('could not find any windows');\n    // Remark: Disabled auto-opening windows ( for now )\n    return;\n    // No suitable window found, create a new one and return a window object for it\n    var newWindow = this.open('new_window_url.html', this.calculateWindowFeaturesForDirection(direction)); // Adjust URL and options as needed\n    if (newWindow) {\n      return {\n        postMessage: function postMessage(message) {\n          _this.channel.postMessage({\n            action: 'sendMessage',\n            // TODO: needs id? or auto-register?\n            targetWindowId: _this.generateWindowId(),\n            // Assuming new window gets a new ID\n            payload: data\n          });\n        }\n      };\n    }\n  }\n}\n\n},{}],7:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = open;\nfunction _typeof(o) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o; }, _typeof(o); }\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }\nfunction _iterableToArrayLimit(r, l) { var t = null == r ? null : \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"]; if (null != t) { var e, n, i, u, a = [], f = !0, o = !1; try { if (i = (t = t.call(r)).next, 0 === l) { if (Object(t) !== t) return; f = !1; } else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0); } catch (r) { o = !0, n = r; } finally { try { if (!f && null != t[\"return\"] && (u = t[\"return\"](), Object(u) !== u)) return; } finally { if (o) throw n; } } return a; } }\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == _typeof(i) ? i : String(i); }\nfunction _toPrimitive(t, r) { if (\"object\" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != _typeof(i)) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nfunction open(url) {\n  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var adjustCurrentWindow = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n  // Check if URL is provided\n  if (!url) {\n    console.error('URL is required to open a new window.');\n    return;\n  }\n\n  // Default window features\n  var defaultFeatures = {\n    width: 600,\n    // Default width\n    height: 400,\n    // Default height\n    menubar: 'no',\n    toolbar: 'no',\n    location: 'no',\n    status: 'no',\n    scrollbars: 'yes',\n    resizable: 'yes',\n    title: new Date().toISOString(),\n    // Default title\n    top: window.screenY + 100,\n    // Default top position\n    left: window.screenX + 100 // Default left position\n  };\n\n  // Merge default features with custom options\n  var features = _objectSpread(_objectSpread({}, defaultFeatures), options);\n\n  // If adjustCurrentWindow is true, resize and reposition the current window\n  if (adjustCurrentWindow) {\n    window.resizeTo(window.outerWidth / 2, window.outerHeight / 2);\n    window.moveTo(features.left, features.top);\n    // Adjust new window's size to fill the empty space\n    features.width = window.outerWidth;\n    features.height = window.outerHeight;\n  }\n\n  // Convert features object to a comma-separated string\n  var featuresStr = Object.entries(features).map(function (_ref) {\n    var _ref2 = _slicedToArray(_ref, 2),\n      key = _ref2[0],\n      value = _ref2[1];\n    return \"\".concat(key, \"=\").concat(value);\n  }).join(',');\n\n  // Open a new window with the specified URL, name, and configured features\n  var newWindow = window.open(url, features.title, featuresStr);\n  if (newWindow) {\n    // If adjustCurrentWindow is true, position the new window to fill the empty space\n    if (adjustCurrentWindow) {\n      newWindow.moveTo(window.screenX + window.outerWidth, window.screenY);\n    }\n    // Return the reference to the new window for further use\n    return newWindow;\n  } else {\n    console.error('Failed to open a new window. Please check browser popup settings.');\n  }\n}\n\n},{}]},{},[1])(1)\n});\n"],"names":["f","exports","module","define","amd","window","global","self","this","CW","r","e","n","t","o","i","c","require","u","a","Error","code","p","call","length","1","Object","defineProperty","value","enumerable","get","_CrossWindow","createCrossWindow","options","arguments","undefined","obj","__esModule","default","./lib/CrossWindow.js","2","_typeof","Symbol","iterator","constructor","prototype","_defineProperties","target","props","descriptor","configurable","writable","toPrimitive","String","Number","TypeError","key","CommunicationManager","channel","windowId","game","metadataManager","events","setupListeners","Constructor","protoProps","staticProps","_this","onmessage","event","data","action","entities","forEach","entity","createEntity","sourceWindowId","postMessage","markWindowAsActive","targetWindowId","emit","intersectionArea","message","payload","eventName","callback","push","callbacks","3","_getBestWindow","_interopRequireDefault","_open","_CommunicationManager","_MetadataManager","_IntersectionDetector","CrossWindow","metadataKey","instance","concat","Date","now","Math","random","toString","substr","communicationManager","BroadcastChannel","intersectionDetector","on","bind","open","getBestWindow","getWindowMetadata","registerWindow","updateWindowMetadata","pingOtherWindows","setTimeout","removeInactiveWindows","deregisterWindow","./CommunicationManager.js","./IntersectionDetector.js","./MetadataManager.js","./getBestWindow.js","./open.js","4","_slicedToArray","arr","Array","isArray","l","next","done","minLen","_arrayLikeToArray","slice","name","from","test","len","arr2","IntersectionDetector","prevMetadata","startMetadataPolling","setInterval","currentMetadata","hasMetadataChanged","checkForIntersections","_this2","allWindowsMetadata","JSON","parse","localStorage","getItem","entries","_ref","_ref2","metadata","isOverlapping","emitIntersectionEvent","calculateIntersection","metadata1","metadata2","position","x","size","width","y","height","x1","max","y1","min","5","ownKeys","keys","getOwnPropertySymbols","filter","getOwnPropertyDescriptor","apply","_objectSpread","_toPropertyKey","getOwnPropertyDescriptors","defineProperties","MetadataManager","screenX","screenY","innerWidth","innerHeight","lastActive","setItem","stringify","timeout","currentTime","6","entityData","direction","screenPosition","centerX","centerY","console","log","flashMessage","bestWindowId","minDistance","Infinity","point1","dx","point2","dy","distance","sqrt","newEntryPosition","sendMessage","7","url","adjustCurrentWindow","features","menubar","toolbar","location","status","scrollbars","resizable","title","toISOString","top","left","featuresStr","resizeTo","outerWidth","outerHeight","moveTo","map","join","newWindow","error"],"mappings":"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"}