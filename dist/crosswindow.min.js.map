{"version":3,"sourceRoot":"../","sources":["./dist/crosswindow.js"],"sourcesContent":["(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.CW = f()}})(function(){var define,module,exports;return (function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nObject.defineProperty(exports, \"CrossWindow\", {\n  enumerable: true,\n  get: function get() {\n    return _CrossWindow[\"default\"];\n  }\n});\nexports.createCrossWindow = createCrossWindow;\nvar _CrossWindow = _interopRequireDefault(require(\"./lib/CrossWindow.js\"));\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\nfunction createCrossWindow() {\n  var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  return new _CrossWindow[\"default\"](options);\n}\n\n},{\"./lib/CrossWindow.js\":3}],2:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\nfunction _typeof(o) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o; }, _typeof(o); }\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor); } }\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == _typeof(i) ? i : String(i); }\nfunction _toPrimitive(t, r) { if (\"object\" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != _typeof(i)) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nvar CommunicationManager = exports[\"default\"] = /*#__PURE__*/function () {\n  function CommunicationManager(channel, cw, game, metadataManager) {\n    _classCallCheck(this, CommunicationManager);\n    this.channel = channel;\n    this.windowId = cw.windowId;\n    this.game = game;\n    this.cw = cw;\n    this.metadataManager = metadataManager;\n    this.setupListeners();\n    this.startPing();\n  }\n  _createClass(CommunicationManager, [{\n    key: \"setupListeners\",\n    value: function setupListeners() {\n      var _this = this;\n      this.channel.onmessage = function (event) {\n        var data = event.data;\n        switch (data.action) {\n          case 'ping':\n            if (data.sourceWindowId !== _this.windowId) _this.channel.postMessage({\n              action: 'pong',\n              sourceWindowId: _this.windowId\n            });\n            break;\n          case 'pong':\n            if (data.sourceWindowId !== _this.windowId) _this.metadataManager.markWindowAsActive(data.sourceWindowId);\n            break;\n          case 'sendMessage':\n            if (data.targetWindowId === 'any') _this.cw.emit('message', data);\n            if (data.targetWindowId === _this.windowId) _this.cw.emit('message', data);\n            break;\n          case 'intersecting':\n            if (data.sourceWindowId !== _this.windowId) _this.cw.emit('intersecting', data);\n            break;\n        }\n      };\n    }\n  }, {\n    key: \"startPing\",\n    value: function startPing() {\n      var _this2 = this;\n      setInterval(function () {\n        _this2.channel.postMessage({\n          action: 'ping',\n          sourceWindowId: _this2.windowId\n        });\n      }, 1000); // Send ping every second\n    }\n  }, {\n    key: \"sendMessage\",\n    value: function sendMessage(targetWindowId, message) {\n      this.channel.postMessage({\n        action: 'sendMessage',\n        targetWindowId: targetWindowId,\n        sourceWindowId: this.windowId,\n        payload: message\n      });\n    }\n  }]);\n  return CommunicationManager;\n}();\n\n},{}],3:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\nvar _getBestWindow = _interopRequireDefault(require(\"./getBestWindow.js\"));\nvar _open = _interopRequireDefault(require(\"./open.js\"));\nvar _CommunicationManager = _interopRequireDefault(require(\"./CommunicationManager.js\"));\nvar _MetadataManager = _interopRequireDefault(require(\"./MetadataManager.js\"));\nvar _IntersectionDetector = _interopRequireDefault(require(\"./IntersectionDetector.js\"));\nvar _updateOrCreateDebugContainer = _interopRequireDefault(require(\"./updateOrCreateDebugContainer.js\"));\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\nfunction _typeof(o) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o; }, _typeof(o); }\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor); } }\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == _typeof(i) ? i : String(i); }\nfunction _toPrimitive(t, r) { if (\"object\" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != _typeof(i)) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); } // CrossWindow.js - Marak Squires 2024\n// A class to manage communication and entity movement between multiple windows\n// Supports opening new windows, sending messages, and teleporting entities between windows\n// Also supports detecting and handling window intersections\n// The debug containers are optional, but useful for debugging so included with default package\n// These could could be separate bundle to further reduce size\nvar CrossWindow = exports[\"default\"] = /*#__PURE__*/function () {\n  function CrossWindow(game) {\n    var metadataKey = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'windowMetadata';\n    _classCallCheck(this, CrossWindow);\n    this.game = game;\n    this.metadataKey = metadataKey;\n    this.events = {};\n    this.windowId = \"\".concat(Date.now(), \"-\").concat(Math.random().toString(36).substr(2, 9));\n    this.metadataManager = new _MetadataManager[\"default\"](metadataKey, this);\n    this.communicationManager = new _CommunicationManager[\"default\"](new BroadcastChannel('crosswindow_channel'), this, game, this.metadataManager);\n    //this.on = this.communicationManager.on.bind(this.communicationManager);\n    //this.emit = this.communicationManager.emit.bind(this.communicationManager);\n    this.intersectionDetector = new _IntersectionDetector[\"default\"](this.metadataManager, this.windowId);\n    this.open = _open[\"default\"].bind(this);\n    this.getBestWindow = _getBestWindow[\"default\"].bind(this);\n    this.getWindows = this.metadataManager.getWindows.bind(this.metadataManager);\n    this.getCurrentWindows = this.metadataManager.getCurrentWindows.bind(this.metadataManager);\n    this.getWindowMetadata = this.metadataManager.getWindowMetadata.bind(this);\n    this.pollWindows = this.metadataManager.pollWindows.bind(this.metadataManager);\n    this.postMessage = this.communicationManager.sendMessage.bind(this.communicationManager);\n    this.registerWindow();\n    this.metadataManager.startHeartbeat();\n    this.updateOrCreateDebugContainer = _updateOrCreateDebugContainer[\"default\"].bind(this);\n  }\n  _createClass(CrossWindow, [{\n    key: \"on\",\n    value: function on(eventName, callback) {\n      if (!this.events[eventName]) this.events[eventName] = [];\n      this.events[eventName].push(callback);\n    }\n  }, {\n    key: \"emit\",\n    value: function emit(eventName, data) {\n      var callbacks = this.events[eventName];\n      if (callbacks) callbacks.forEach(function (callback) {\n        return callback(data);\n      });\n    }\n  }, {\n    key: \"registerWindow\",\n    value: function registerWindow() {\n      this.metadataManager.updateWindowMetadata();\n      this.pingOtherWindows();\n    }\n  }, {\n    key: \"pingOtherWindows\",\n    value: function pingOtherWindows() {\n      var _this = this;\n      var channel = new BroadcastChannel('crosswindow_channel');\n      channel.postMessage({\n        action: 'ping',\n        sourceWindowId: this.windowId\n      });\n      setTimeout(function () {\n        return _this.metadataManager.removeInactiveWindows();\n      }, 100);\n    }\n  }, {\n    key: \"deregisterWindow\",\n    value: function deregisterWindow() {\n      this.metadataManager.deregisterWindow();\n    }\n  }]);\n  return CrossWindow;\n}();\n\n},{\"./CommunicationManager.js\":2,\"./IntersectionDetector.js\":4,\"./MetadataManager.js\":5,\"./getBestWindow.js\":6,\"./open.js\":7,\"./updateOrCreateDebugContainer.js\":8}],4:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\nfunction _typeof(o) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o; }, _typeof(o); }\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }\nfunction _iterableToArrayLimit(r, l) { var t = null == r ? null : \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"]; if (null != t) { var e, n, i, u, a = [], f = !0, o = !1; try { if (i = (t = t.call(r)).next, 0 === l) { if (Object(t) !== t) return; f = !1; } else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0); } catch (r) { o = !0, n = r; } finally { try { if (!f && null != t[\"return\"] && (u = t[\"return\"](), Object(u) !== u)) return; } finally { if (o) throw n; } } return a; } }\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor); } }\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == _typeof(i) ? i : String(i); }\nfunction _toPrimitive(t, r) { if (\"object\" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != _typeof(i)) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\n// The intersection detector class is responsible for detecting intersections between the current window and other windows.\n// This can be used to create \"x-ray\" style effects, or shared entities between windows.\nvar IntersectionDetector = exports[\"default\"] = /*#__PURE__*/function () {\n  function IntersectionDetector(metadataManager, windowId) {\n    _classCallCheck(this, IntersectionDetector);\n    this.metadataManager = metadataManager;\n    this.windowId = windowId;\n    this.prevMetadata = null;\n    this.startMetadataPolling();\n  }\n  _createClass(IntersectionDetector, [{\n    key: \"startMetadataPolling\",\n    value: function startMetadataPolling() {\n      var _this = this;\n      this.prevMetadata = this.metadataManager.getWindowMetadata();\n      setInterval(function () {\n        var currentMetadata = _this.metadataManager.getWindowMetadata();\n        if (_this.metadataManager.hasMetadataChanged(_this.prevMetadata, currentMetadata)) {\n          _this.metadataManager.updateWindowMetadata(currentMetadata);\n          _this.checkForIntersections(currentMetadata);\n        }\n      }, 100);\n    }\n  }, {\n    key: \"checkForIntersections\",\n    value: function checkForIntersections(currentMetadata) {\n      var _this2 = this;\n      var allWindowsMetadata = JSON.parse(localStorage.getItem(this.metadataManager.metadataKey)) || {};\n      Object.entries(allWindowsMetadata).forEach(function (_ref) {\n        var _ref2 = _slicedToArray(_ref, 2),\n          windowId = _ref2[0],\n          metadata = _ref2[1];\n        if (windowId !== _this2.windowId && _this2.isOverlapping(currentMetadata, metadata)) {\n          _this2.emitIntersectionEvent(windowId, _this2.calculateIntersection(currentMetadata, metadata));\n        }\n      });\n    }\n  }, {\n    key: \"isOverlapping\",\n    value: function isOverlapping(metadata1, metadata2) {\n      return !(metadata2.position.x >= metadata1.position.x + metadata1.size.width || metadata2.position.x + metadata2.size.width <= metadata1.position.x || metadata2.position.y >= metadata1.position.y + metadata1.size.height || metadata2.position.y + metadata2.size.height <= metadata1.position.y);\n    }\n  }, {\n    key: \"calculateIntersection\",\n    value: function calculateIntersection(metadata1, metadata2) {\n      var x1 = Math.max(metadata1.position.x, metadata2.position.x);\n      var y1 = Math.max(metadata1.position.y, metadata2.position.y);\n      var x2 = Math.min(metadata1.position.x + metadata1.size.width, metadata2.position.x + metadata2.size.width);\n      var y2 = Math.min(metadata1.position.y + metadata1.size.height, metadata2.position.y + metadata2.size.height);\n      return {\n        position: {\n          x: x1,\n          y: y1\n        },\n        size: {\n          width: x2 - x1,\n          height: y2 - y1\n        }\n      };\n    }\n  }, {\n    key: \"emitIntersectionEvent\",\n    value: function emitIntersectionEvent(targetWindowId, intersectionArea) {\n      var channel = new BroadcastChannel('crosswindow_channel');\n      channel.postMessage({\n        action: 'intersecting',\n        sourceWindowId: this.windowId,\n        targetWindowId: targetWindowId,\n        intersectionArea: intersectionArea\n      });\n    }\n  }]);\n  return IntersectionDetector;\n}();\n\n},{}],5:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\nfunction _typeof(o) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o; }, _typeof(o); }\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }\nfunction _iterableToArrayLimit(r, l) { var t = null == r ? null : \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"]; if (null != t) { var e, n, i, u, a = [], f = !0, o = !1; try { if (i = (t = t.call(r)).next, 0 === l) { if (Object(t) !== t) return; f = !1; } else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0); } catch (r) { o = !0, n = r; } finally { try { if (!f && null != t[\"return\"] && (u = t[\"return\"](), Object(u) !== u)) return; } finally { if (o) throw n; } } return a; } }\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor); } }\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == _typeof(i) ? i : String(i); }\nfunction _toPrimitive(t, r) { if (\"object\" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != _typeof(i)) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nvar MetadataManager = exports[\"default\"] = /*#__PURE__*/function () {\n  function MetadataManager(metadataKey, cw) {\n    _classCallCheck(this, MetadataManager);\n    this.metadataKey = metadataKey;\n    this.windowId = cw.windowId;\n    this.emit = cw.emit.bind(cw);\n    this.currentWindows = {};\n  }\n  _createClass(MetadataManager, [{\n    key: \"getCurrentWindows\",\n    value: function getCurrentWindows() {\n      return this.currentWindows;\n    }\n  }, {\n    key: \"getWindows\",\n    value: function getWindows() {\n      return JSON.parse(localStorage.getItem(this.metadataKey)) || {};\n    }\n  }, {\n    key: \"startHeartbeat\",\n    value: function startHeartbeat() {\n      var _this = this;\n      setInterval(function () {\n        _this.updateWindowMetadata(); // Update current window's metadata\n        _this.removeInactiveWindows(200); // milliseconds\n      }, 200); // Update every 200ms\n    }\n  }, {\n    key: \"pollWindows\",\n    value: function pollWindows() {\n      var _this2 = this;\n      var prevMetadata = this.getWindows(); // Store the initial state of all windows.\n\n      setInterval(function () {\n        var allWindows = _this2.getWindows(); // Fetch the current state of all windows.\n\n        // Check for closed windows by comparing prevMetadata with the current state\n        Object.keys(prevMetadata).forEach(function (windowId) {\n          if (windowId === _this2.windowId) return; // Skip the current window\n          if (!allWindows.hasOwnProperty(windowId)) {\n            // If a window in prevMetadata is not present in allWindows, it's been closed\n            console.log('gone', windowId, prevMetadata[windowId]);\n            _this2.emit('windowClosed', {\n              windowId: windowId,\n              metadata: prevMetadata[windowId]\n            });\n          }\n        });\n\n        // Iterate through all current windows to check for changes or new windows\n        Object.keys(allWindows).forEach(function (windowId) {\n          var currentWindowMetadata = allWindows[windowId];\n          var prevWindowMetadata = prevMetadata[windowId];\n\n          // Check if the window is new or its metadata has changed\n          //if (!prevWindowMetadata || this.hasMetadataChanged(prevWindowMetadata, currentWindowMetadata)) {\n          // Update the previous metadata state for the next iteration\n          prevMetadata[windowId] = currentWindowMetadata;\n          _this2.currentWindows[windowId] = currentWindowMetadata;\n          // Emit an event for the changed or new window\n          // TODO: without the conditional statement this is now 'windowHeartbeat'\n          // we should split the case and have two events to subscribe to\n          _this2.emit('windowChanged', {\n            windowId: windowId,\n            metadata: currentWindowMetadata\n          });\n          // }\n        });\n\n        // Update prevMetadata to reflect the current state for the next iteration\n        prevMetadata = _objectSpread({}, allWindows);\n      }, 15);\n    }\n  }, {\n    key: \"hasMetadataChanged\",\n    value: function hasMetadataChanged(prevMetadata, currentMetadata) {\n      return prevMetadata.position.x !== currentMetadata.position.x || prevMetadata.position.y !== currentMetadata.position.y || prevMetadata.size.width !== currentMetadata.size.width || prevMetadata.size.height !== currentMetadata.size.height;\n    }\n  }, {\n    key: \"getWindowMetadata\",\n    value: function getWindowMetadata() {\n      return {\n        position: {\n          x: window.screenX,\n          y: window.screenY\n        },\n        size: {\n          width: window.innerWidth,\n          height: window.innerHeight\n        }\n      };\n    }\n  }, {\n    key: \"updateWindowMetadata\",\n    value: function updateWindowMetadata() {\n      var metadata = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.getWindowMetadata();\n      var allWindowsMetadata = JSON.parse(localStorage.getItem(this.metadataKey)) || {};\n      allWindowsMetadata[this.windowId] = _objectSpread(_objectSpread({}, metadata), {}, {\n        lastActive: Date.now()\n      });\n      localStorage.setItem(this.metadataKey, JSON.stringify(allWindowsMetadata));\n    }\n  }, {\n    key: \"removeInactiveWindows\",\n    value: function removeInactiveWindows() {\n      var _this3 = this;\n      var timeout = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1000;\n      var allWindowsMetadata = JSON.parse(localStorage.getItem(this.metadataKey)) || {};\n      var currentTime = Date.now();\n      Object.entries(allWindowsMetadata).forEach(function (_ref) {\n        var _ref2 = _slicedToArray(_ref, 2),\n          windowId = _ref2[0],\n          metadata = _ref2[1];\n        if (currentTime - metadata.lastActive > timeout) {\n          delete allWindowsMetadata[windowId];\n          _this3.currentWindows[windowId] = null;\n        }\n      });\n      localStorage.setItem(this.metadataKey, JSON.stringify(allWindowsMetadata));\n    }\n  }, {\n    key: \"markWindowAsActive\",\n    value: function markWindowAsActive(windowId) {\n      var allWindowsMetadata = JSON.parse(localStorage.getItem(this.metadataKey)) || {};\n      if (allWindowsMetadata[windowId]) {\n        allWindowsMetadata[windowId].lastActive = Date.now();\n        localStorage.setItem(this.metadataKey, JSON.stringify(allWindowsMetadata));\n      }\n    }\n  }, {\n    key: \"deregisterWindow\",\n    value: function deregisterWindow() {\n      var allWindowsMetadata = JSON.parse(localStorage.getItem(this.metadataKey)) || {};\n      delete allWindowsMetadata[this.windowId];\n      localStorage.setItem(this.metadataKey, JSON.stringify(allWindowsMetadata));\n    }\n  }]);\n  return MetadataManager;\n}();\n\n},{}],6:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = getBestWindow;\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }\nfunction _iterableToArrayLimit(r, l) { var t = null == r ? null : \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"]; if (null != t) { var e, n, i, u, a = [], f = !0, o = !1; try { if (i = (t = t.call(r)).next, 0 === l) { if (Object(t) !== t) return; f = !1; } else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0); } catch (r) { o = !0, n = r; } finally { try { if (!f && null != t[\"return\"] && (u = t[\"return\"](), Object(u) !== u)) return; } finally { if (o) throw n; } } return a; } }\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\nfunction calculateEntryPosition(direction, position, bestWindowId) {\n  // get the latest metadata about bestWindowId from localStorage\n  var allWindowsMetadata = JSON.parse(localStorage.getItem('windowMetadata')) || {};\n  var bestWindowMetadata = allWindowsMetadata[bestWindowId];\n  if (!bestWindowMetadata) {\n    console.error('calculateEntryPosition: bestWindowMetadata not found for windowId', bestWindowId);\n    return;\n  }\n\n  // console.log('bestWindowMetadata', bestWindowMetadata)\n\n  var bestWindowSize = bestWindowMetadata.size;\n  var bestWindowPosition = bestWindowMetadata.position;\n  // we need to determine if the calculated position is outside the bounds of the bestWindow\n  // if it is, we need to clamp the value to the edge of the window\n  // we are working with world coordinates at zoom scale value 1\n  // so we can calculate the world coordinates of the window edges by using\n  // the window position and size\n  var gameWidth = bestWindowSize.width / 2;\n  var gameHeight = bestWindowSize.height / 2;\n  var currentWindowPosition = {\n    x: screenX,\n    y: screenY\n  };\n\n  // console.log('currentWindowPosition', currentWindowPosition)\n  //console.log('bestWindowPosition', bestWindowPosition)\n  //console.log('bestWindowSize', bestWindowSize)\n\n  // Adjust this buffer size as needed\n  var buffer = 66; // any small values should work, without buffer the entity may get stuck in teleportation loop\n  console.log('calculateEntryPosition', direction, position);\n  switch (direction) {\n    case 'E':\n    case 'NE':\n    case 'SE':\n      position.x = -gameWidth / 2 + buffer;\n      break;\n    case 'W':\n    case 'SW':\n    case 'NW':\n      position.x = gameWidth / 2 - buffer;\n      break;\n    case 'N':\n      position.y = gameHeight / 2 - buffer;\n      break;\n    case 'S':\n      position.y = -gameHeight / 2 + buffer;\n      break;\n  }\n  return position;\n}\nfunction calculateDistance(point1, point2) {\n  var dx = point1.x - point2.x;\n  var dy = point1.y - point2.y;\n  return Math.sqrt(dx * dx + dy * dy);\n}\nfunction determineCardinalDirection(screenPosition) {\n  var centerX = window.innerWidth / 2;\n  var centerY = window.innerHeight / 2;\n\n  // Calculate the differences between the screen position and the center\n  var diffX = Math.abs(screenPosition.x - centerX);\n  var diffY = Math.abs(screenPosition.y - centerY);\n\n  // Determine the predominant direction based on the larger difference\n  if (diffX > diffY) {\n    // Horizontal movement is predominant\n    return screenPosition.x < centerX ? 'W' : 'E'; // West or East\n  } else {\n    // Vertical movement is predominant, or equal to horizontal movement\n    return screenPosition.y < centerY ? 'N' : 'S'; // North or South\n  }\n}\nfunction getBestWindow(entityData) {\n  var _this = this;\n  // TODO: entityData.position? we need an API semantic here for .position and .screenPosition\n  var direction = determineCardinalDirection(entityData.screenPosition);\n  var allWindowsMetadata = JSON.parse(localStorage.getItem(this.metadataKey)) || {};\n  if (Object.keys(allWindowsMetadata).length === 0) {\n    game.flashMessage('no other windows found');\n    return;\n  }\n  var currentWindowPosition = getCurrentWindowPosition();\n  var currentWindowSize = getCurrentWindowSize();\n  var bestWindowId = null;\n  var minEdgeDistance = Infinity;\n  var fallbackWindowId = null;\n  var minFallbackDistance = Infinity;\n  Object.entries(allWindowsMetadata).forEach(function (_ref) {\n    var _ref2 = _slicedToArray(_ref, 2),\n      windowId = _ref2[0],\n      metadata = _ref2[1];\n    if (windowId !== _this.windowId) {\n      var edgeDistance = calculateEdgeDistance(direction, metadata.position, metadata.size, currentWindowPosition, currentWindowSize);\n      if (direction === 'E' && metadata.position.x > currentWindowPosition.x) {\n        // Consider windows to the right for East direction\n        if (edgeDistance < minEdgeDistance) {\n          minEdgeDistance = edgeDistance;\n          bestWindowId = windowId;\n        }\n      } else if (direction === 'W' && metadata.position.x < currentWindowPosition.x) {\n        // Consider windows to the left for West direction\n        if (edgeDistance < minEdgeDistance) {\n          minEdgeDistance = edgeDistance;\n          bestWindowId = windowId;\n        }\n      } // Add similar checks for 'N' and 'S' directions if needed\n      else if (direction === 'N' && metadata.position.y < currentWindowPosition.y) {\n        // Consider windows to the left for West direction\n        if (edgeDistance < minEdgeDistance) {\n          minEdgeDistance = edgeDistance;\n          bestWindowId = windowId;\n        }\n      } else if (direction === 'S' && metadata.position.y > currentWindowPosition.y) {\n        // Consider windows to the left for West direction\n        if (edgeDistance < minEdgeDistance) {\n          minEdgeDistance = edgeDistance;\n          bestWindowId = windowId;\n        }\n      }\n      // Fallback for when no window is found in the preferred direction\n      if (edgeDistance < minFallbackDistance) {\n        minFallbackDistance = edgeDistance;\n        fallbackWindowId = windowId;\n      }\n    }\n  });\n\n  // If no suitable window is found in the preferred direction, use the fallback\n  if (!bestWindowId && fallbackWindowId) {\n    bestWindowId = fallbackWindowId;\n  }\n  if (!bestWindowId) {\n    bestWindowId = this.windowId;\n  }\n  return prepareBestWindowResponse(this, bestWindowId, direction, entityData);\n}\n\n// Helper function to get the current window's position\n// Implement this based on how you track window positions in your application\nfunction getCurrentWindowPosition() {\n  // Example return value\n  return {\n    x: window.screenX,\n    y: window.screenY\n  };\n}\n\n// Helper function to get the current window's size\nfunction getCurrentWindowSize() {\n  // Example return value\n  return {\n    width: window.innerWidth,\n    height: window.innerHeight\n  };\n}\nfunction calculateEdgeDistance(direction, targetWindowPosition, targetWindowSize, currentWindowPosition, currentWindowSize) {\n  var edgeDistance;\n  // console.log('calculateEdgeDistance', direction, targetWindowPosition, targetWindowSize, currentWindowPosition, currentWindowSize)\n  switch (direction) {\n    case 'E':\n      // Entity is moving East, so we calculate the distance from the current window's right edge to the target window's left edge\n      edgeDistance = targetWindowPosition.x - (currentWindowPosition.x + currentWindowSize.width);\n      break;\n    case 'W':\n      // Entity is moving West, so we calculate the distance from the current window's left edge to the target window's right edge\n      edgeDistance = currentWindowPosition.x - (targetWindowPosition.x + targetWindowSize.width);\n      break;\n    case 'N':\n      // Entity is moving North, so we calculate the distance from the current window's top edge to the target window's bottom edge\n      edgeDistance = currentWindowPosition.y - (targetWindowPosition.y + targetWindowSize.height);\n      break;\n    case 'S':\n      // Entity is moving South, so we calculate the distance from the current window's bottom edge to the target window's top edge\n      edgeDistance = targetWindowPosition.y - (currentWindowPosition.y + currentWindowSize.height);\n      break;\n    // Handle diagonal directions if needed by combining logic for horizontal and vertical edges\n    // e.g., for NE, use the logic from N and E to find the shortest edge distance\n    default:\n      edgeDistance = Infinity; // Default case to handle unexpected directions\n      break;\n  }\n\n  // console.log('calcuate distance', edgeDistance, direction, targetWindowPosition, targetWindowSize, currentWindowPosition, currentWindowSize)\n\n  return edgeDistance;\n}\nfunction prepareBestWindowResponse(cw, bestWindowId, direction, entityData) {\n  return {\n    windowId: bestWindowId,\n    direction: direction,\n    entryPosition: calculateEntryPosition(direction, entityData.position, bestWindowId),\n    postMessage: function postMessage(data) {\n      var newEntryPosition = calculateEntryPosition(direction, data.position, bestWindowId);\n      data.position = newEntryPosition;\n      data.direction = direction;\n      cw.communicationManager.sendMessage(bestWindowId, data);\n    }\n  };\n}\n\n},{}],7:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = open;\nfunction _typeof(o) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o; }, _typeof(o); }\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }\nfunction _iterableToArrayLimit(r, l) { var t = null == r ? null : \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"]; if (null != t) { var e, n, i, u, a = [], f = !0, o = !1; try { if (i = (t = t.call(r)).next, 0 === l) { if (Object(t) !== t) return; f = !1; } else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0); } catch (r) { o = !0, n = r; } finally { try { if (!f && null != t[\"return\"] && (u = t[\"return\"](), Object(u) !== u)) return; } finally { if (o) throw n; } } return a; } }\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == _typeof(i) ? i : String(i); }\nfunction _toPrimitive(t, r) { if (\"object\" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != _typeof(i)) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nfunction open(url) {\n  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var adjustCurrentWindow = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n  if (!url) {\n    console.error('URL is required to open a new window.');\n    return;\n  }\n  var availableScreenWidth = screen.availWidth - window.screenX;\n  var availableScreenHeight = screen.availHeight - window.screenY;\n  var defaultFeatures = {\n    width: Math.min(window.outerWidth, availableScreenWidth - 100),\n    height: Math.min(window.outerHeight, availableScreenHeight - 100),\n    menubar: 'no',\n    toolbar: 'no',\n    location: 'no',\n    status: 'no',\n    scrollbars: 'yes',\n    resizable: 'yes',\n    title: new Date().toISOString(),\n    left: window.screenX + window.outerWidth + 100,\n    top: window.screenY\n  };\n  var features = _objectSpread(_objectSpread({}, defaultFeatures), options);\n  if (adjustCurrentWindow && (features.left + features.width > screen.availWidth || features.top + features.height > screen.availHeight)) {\n    var halfWidth = Math.floor(window.outerWidth / 2);\n    var halfHeight = Math.floor(window.outerHeight / 2);\n\n    // window.resizeTo(halfWidth, halfHeight);\n\n    // Determine an appropriate offset to maintain proximity without overlap\n    var offsetX = window.screenX + halfWidth + features.width > screen.availWidth ? screen.availWidth - features.width - halfWidth : window.screenX;\n    var offsetY = window.screenY + halfHeight + features.height > screen.availHeight ? screen.availHeight - features.height - halfHeight : window.screenY;\n\n    // window.moveTo(offsetX, offsetY);\n\n    features.width = halfWidth;\n    features.height = halfHeight;\n    features.left = offsetX + halfWidth; // Place new window to the right of the resized current window\n    // features.top = offsetY; // Align new window's top with the current window's top\n  }\n  var featuresStr = Object.entries(features).map(function (_ref) {\n    var _ref2 = _slicedToArray(_ref, 2),\n      key = _ref2[0],\n      value = _ref2[1];\n    return \"\".concat(key, \"=\").concat(value);\n  }).join(',');\n  var newWindow = window.open(url, features.title, featuresStr);\n  if (newWindow) {\n    return newWindow;\n  } else {\n    console.error('Failed to open a new window. Please check browser popup settings.');\n  }\n}\n\n},{}],8:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = updateOrCreateDebugContainer;\nfunction updateOrCreateDebugContainer(currentWindowMetadata) {\n  var container = document.getElementById('windowsContainer');\n  var boxId = 'windowBox_' + currentWindowMetadata.windowId;\n  var windowBox = document.getElementById(boxId);\n  if (!windowBox) {\n    windowBox = document.createElement('div');\n    windowBox.id = boxId;\n    windowBox.style.textAlign = 'center';\n    windowBox.classList.add('debug-window-box'); // Use CSS class for styling\n\n    var windowIdSpan = document.createElement('span');\n    windowIdSpan.style.backgroundColor = '#fff';\n    windowIdSpan.style.height = '20px';\n    windowIdSpan.style.fontWeight = 'bold';\n    windowIdSpan.style.width = '100%';\n    windowIdSpan.style.color = 'black';\n    windowIdSpan.style.padding = '5px';\n    windowIdSpan.style.margin = '0';\n    if (currentWindowMetadata.windowId === this.windowId) {\n      // Highlight our own window\n      windowBox.style.borderColor = '#007fff';\n    }\n    windowIdSpan.textContent = currentWindowMetadata.windowId.split('-')[1];\n    windowBox.appendChild(windowIdSpan);\n    container.appendChild(windowBox);\n  }\n  var adjustedPosition = calculateAdjustedPosition(currentWindowMetadata);\n\n  //console.log(currentWindowMetadata.windowId, this.windowId) \n  if (currentWindowMetadata.windowId === this.windowId) {\n    // center the box always its our own\n    //console.log(\"SEESESESESE\")\n    adjustedPosition.x = window.innerWidth / 2 - 55;\n    adjustedPosition.y = window.innerHeight / 2 - adjustedPosition.height / 2 - 200;\n    //windowBox.style.transform = 'translate(-50%, -50%)';\n  }\n  windowBox.style.left = \"\".concat(adjustedPosition.x, \"px\");\n  windowBox.style.top = \"\".concat(adjustedPosition.y, \"px\");\n  updatePositionInfo(windowBox, adjustedPosition, currentWindowMetadata);\n}\nfunction calculateAdjustedPosition(currentWindowMetadata) {\n  var scaleFactor = 0.2; // Adjust scale factor as needed\n  var buffer = 16; // Buffer to avoid edge sticking\n  var viewportWidth = window.innerWidth;\n  var viewportHeight = window.innerHeight;\n  var _currentWindowMetadat = currentWindowMetadata.metadata.size,\n    width = _currentWindowMetadat.width,\n    height = _currentWindowMetadat.height;\n  width *= scaleFactor;\n  height *= scaleFactor;\n\n  // Calculate relative position\n  var x = currentWindowMetadata.metadata.position.x - window.screenX + width / 2;\n  var y = currentWindowMetadata.metadata.position.y - window.screenY + height / 2;\n\n  // Adjust to keep within viewport and apply buffer\n  x = Math.min(Math.max(x, buffer), viewportWidth - width - buffer);\n  y = Math.min(Math.max(y, buffer), viewportHeight - height - buffer);\n  return {\n    x: x,\n    y: y,\n    width: width,\n    height: height\n  };\n}\nfunction updatePositionInfo(windowBox, position, currentWindowMetadata) {\n  var positionInfoSpan = windowBox.querySelector('.position-info');\n  if (!positionInfoSpan) {\n    positionInfoSpan = document.createElement('span');\n    positionInfoSpan.className = 'position-info';\n    positionInfoSpan.style.textAlign = 'left';\n    windowBox.appendChild(positionInfoSpan);\n  }\n  var distance = calculateDistance(position, {\n    x: window.screenX,\n    y: window.screenY\n  });\n  positionInfoSpan.innerHTML = \"X: \".concat(position.x.toFixed(0), \"<br/>Y: \").concat(position.y.toFixed(0), \"<br/>Dist: \").concat(Math.round(distance), \"px\");\n}\nfunction calculateDistance(point1, point2) {\n  var dx = point1.x - point2.x;\n  var dy = point1.y - point2.y;\n  return Math.sqrt(dx * dx + dy * dy);\n}\n\n},{}]},{},[1])(1)\n});\n"],"names":["f","exports","module","define","amd","window","global","self","this","CW","r","e","n","t","o","i","c","require","u","a","Error","code","p","call","length","1","Object","defineProperty","value","enumerable","get","_CrossWindow","createCrossWindow","options","arguments","undefined","obj","__esModule","default","./lib/CrossWindow.js","2","_typeof","Symbol","iterator","constructor","prototype","_defineProperties","target","props","descriptor","configurable","writable","toPrimitive","String","Number","TypeError","key","CommunicationManager","channel","cw","game","metadataManager","windowId","setupListeners","startPing","Constructor","protoProps","staticProps","_this","onmessage","event","data","action","sourceWindowId","postMessage","markWindowAsActive","targetWindowId","emit","_this2","setInterval","message","payload","3","_getBestWindow","_interopRequireDefault","_open","_CommunicationManager","_MetadataManager","_IntersectionDetector","_updateOrCreateDebugContainer","CrossWindow","metadataKey","instance","events","concat","Date","now","Math","random","toString","substr","communicationManager","BroadcastChannel","intersectionDetector","open","bind","getBestWindow","getWindows","getCurrentWindows","getWindowMetadata","pollWindows","sendMessage","registerWindow","startHeartbeat","updateOrCreateDebugContainer","eventName","callback","push","callbacks","forEach","updateWindowMetadata","pingOtherWindows","setTimeout","removeInactiveWindows","deregisterWindow","./CommunicationManager.js","./IntersectionDetector.js","./MetadataManager.js","./getBestWindow.js","./open.js","./updateOrCreateDebugContainer.js","4","_slicedToArray","arr","Array","isArray","l","next","done","minLen","_arrayLikeToArray","slice","name","from","test","len","arr2","IntersectionDetector","prevMetadata","startMetadataPolling","currentMetadata","hasMetadataChanged","checkForIntersections","allWindowsMetadata","JSON","parse","localStorage","getItem","entries","_ref","_ref2","metadata","isOverlapping","emitIntersectionEvent","calculateIntersection","metadata1","metadata2","position","x","size","width","y","height","x1","max","y1","min","intersectionArea","5","ownKeys","keys","getOwnPropertySymbols","filter","getOwnPropertyDescriptor","apply","_objectSpread","_toPropertyKey","getOwnPropertyDescriptors","defineProperties","MetadataManager","currentWindows","allWindows","hasOwnProperty","console","log","currentWindowMetadata","screenX","screenY","innerWidth","innerHeight","lastActive","setItem","stringify","_this3","timeout","currentTime","6","calculateEntryPosition","direction","bestWindowId","bestWindowMetadata","bestWindowSize","gameWidth","gameHeight","error","entityData","currentWindowPosition","currentWindowSize","minEdgeDistance","fallbackWindowId","minFallbackDistance","screenPosition","centerX","centerY","diffX","abs","diffY","Infinity","edgeDistance","targetWindowPosition","targetWindowSize","entryPosition","newEntryPosition","flashMessage","7","url","adjustCurrentWindow","availableScreenWidth","screen","availWidth","availableScreenHeight","availHeight","features","outerWidth","outerHeight","menubar","toolbar","location","status","scrollbars","resizable","title","toISOString","left","top","featuresStr","halfWidth","floor","halfHeight","offsetX","map","join","newWindow","8","container","document","getElementById","boxId","windowBox","createElement","id","style","textAlign","classList","add","windowIdSpan","backgroundColor","fontWeight","color","padding","margin","borderColor","textContent","split","appendChild","adjustedPosition","viewportWidth","viewportHeight","_currentWindowMetadat","positionInfoSpan","querySelector","className","distance","point1","point2","dx","dy","sqrt","innerHTML","toFixed","round"],"mappings":"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"}