!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).CW=e()}(function(){return function r(o,i,a){function s(t,e){if(!i[t]){if(!o[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(u)return u(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}n=i[t]={exports:{}},o[t][0].call(n.exports,function(e){return s(o[t][1][e]||e)},n,n.exports,r,o,i,a)}return i[t].exports}for(var u="function"==typeof require&&require,e=0;e<a.length;e++)s(a[e]);return s}({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"CrossWindow",{enumerable:!0,get:function(){return r.default}}),n.createCrossWindow=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new r.default(e)};var r=(n=e("./lib/CrossWindow.js"))&&n.__esModule?n:{default:n}},{"./lib/CrossWindow.js":3}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i=(e=e("./EventReceiver.js"))&&e.__esModule?e:{default:e};function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!=o(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==o(e)?e:String(e)}(r.key),r)}}n.default=function(){function o(e,t,n,r){if(!(this instanceof o))throw new TypeError("Cannot call a class as a function");this.channel=e,this.windowId=t.windowId,this.cw=t,this.metadataManager=r,this.eventReceiver=new i.default(t),this.setupListeners(),this.startPing()}var e,t,n;return e=o,(t=[{key:"setupListeners",value:function(){var n=this;this.channel.onmessage=function(e){var t=e.data;switch(t.action){case"ping":t.sourceWindowId!==n.windowId&&n.channel.postMessage({action:"pong",sourceWindowId:n.windowId});break;case"pong":t.sourceWindowId!==n.windowId&&n.metadataManager.markWindowAsActive(t.sourceWindowId);break;case"message":"any"===t.targetWindowId&&n.cw.emit("message",t),t.targetWindowId===n.windowId&&n.cw.emit("message",t);break;case"intersecting":t.sourceWindowId!==n.windowId&&n.cw.emit("intersecting",t);break;case"keydown":case"keyup":t.sourceWindowId!==n.windowId&&n.eventReceiver.handleKeyboardEvent(t);break;case"mouseEvent":n.eventReceiver.handleMouseEvent(t)}}}},{key:"startPing",value:function(){var e=this;setInterval(function(){e.channel.postMessage({action:"ping",sourceWindowId:e.windowId})},1e3)}},{key:"sendMessage",value:function(e){e.targetWindowId===this.windowId?this.cw.emit("message",{sourceWindowId:this.windowId,payload:e}):(e.sourceWindowId=this.windowId,this.channel.postMessage(e))}}])&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),o}()},{"./EventReceiver.js":4}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var o=r(e("./getBestWindow.js")),i=r(e("./open.js")),a=r(e("./CommunicationManager.js")),s=r(e("./MetadataManager.js")),u=r(e("./IntersectionDetector.js")),c=r(e("./KeyboardEventBroadcaster.js")),l=r(e("./MouseEventBroadcaster.js"));function r(e){return e&&e.__esModule?e:{default:e}}function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!=d(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=d(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==d(e)?e:String(e)}(r.key),r)}}n.default=function(){function r(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=this,n=r;if(!(t instanceof n))throw new TypeError("Cannot call a class as a function");this.config={},this.config.metadataKey=e.metadataKey||"windowMetadata",this.events={},this.windowId="".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),this.metadataManager=new s.default(this),this.communicationManager=new a.default(new BroadcastChannel("crosswindow_channel"),this,null,this.metadataManager),this.intersectionDetector=new u.default(this.metadataManager,this.windowId),this.keyboardEventBroadcaster=new c.default(this),this.mouseEventBroadcaster=new l.default(this),this.open=i.default.bind(this),this.getBestWindow=o.default.bind(this),this.getWindows=this.metadataManager.getWindows.bind(this.metadataManager),this.getCurrentWindows=this.metadataManager.getCurrentWindows.bind(this.metadataManager),this.getWindowMetadata=this.metadataManager.getWindowMetadata.bind(this),this.pollWindows=this.metadataManager.pollWindows.bind(this.metadataManager),this.postMessage=this.communicationManager.sendMessage.bind(this.communicationManager),this.registerWindow(),this.pollWindows(),this.metadataManager.startHeartbeat()}var e,t,n;return e=r,(t=[{key:"on",value:function(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t)}},{key:"emit",value:function(e,t){e=this.events[e];e&&e.forEach(function(e){return e(t)})}},{key:"registerWindow",value:function(){this.metadataManager.updateWindowMetadata(),this.pingOtherWindows()}},{key:"pingOtherWindows",value:function(){var e=this;new BroadcastChannel("crosswindow_channel").postMessage({action:"ping",sourceWindowId:this.windowId}),setTimeout(function(){return e.metadataManager.removeInactiveWindows()},100)}},{key:"deregisterWindow",value:function(){this.metadataManager.deregisterWindow()}}])&&f(e.prototype,t),n&&f(e,n),Object.defineProperty(e,"prototype",{writable:!1}),r}()},{"./CommunicationManager.js":2,"./IntersectionDetector.js":5,"./KeyboardEventBroadcaster.js":6,"./MetadataManager.js":7,"./MouseEventBroadcaster.js":8,"./getBestWindow.js":9,"./open.js":10}],4:[function(e,t,n){"use strict";function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!=o(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==o(e)?e:String(e)}(r.key),r)}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;n.default=function(){function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.crosswindow=e}var e,n,r;return e=t,(n=[{key:"handleKeyboardEvent",value:function(e){e.sourceWindowId!==this.crosswindow.windowId&&(e=new KeyboardEvent(e.action,{code:e.message.code,repeat:e.message.repeat,shiftKey:e.message.shiftKey,ctrlKey:e.message.ctrlKey,altKey:e.message.altKey,metaKey:e.message.metaKey,bubbles:!1}),document.dispatchEvent(e))}},{key:"handleMouseEvent",value:function(e){e.sourceWindowId!==this.crosswindow.windowId&&(e=new MouseEvent(e.message.type,{clientX:e.message.x,clientY:e.message.y,button:e.message.button,ctrlKey:e.message.ctrlKey,shiftKey:e.message.shiftKey,altKey:e.message.altKey,metaKey:e.message.metaKey,bubbles:!1}),document.dispatchEvent(e))}}])&&i(e.prototype,n),r&&i(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}()},{}],5:[function(e,t,n){"use strict";function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,s=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return s}}(e,t)||function(e,t){var n;if(e)return"string"==typeof e?r(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!=o(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==o(e)?e:String(e)}(r.key),r)}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;n.default=function(){function n(e,t){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");this.metadataManager=e,this.windowId=t,this.prevMetadata=null,this.startMetadataPolling()}var e,t,r;return e=n,(t=[{key:"startMetadataPolling",value:function(){var t=this;this.prevMetadata=this.metadataManager.getWindowMetadata(),setInterval(function(){var e=t.metadataManager.getWindowMetadata();t.metadataManager.hasMetadataChanged(t.prevMetadata,e)&&(t.metadataManager.updateWindowMetadata(e),t.checkForIntersections(e))},100)}},{key:"checkForIntersections",value:function(n){var r=this,e=JSON.parse(localStorage.getItem(this.metadataManager.metadataKey))||{};Object.entries(e).forEach(function(e){var e=i(e,2),t=e[0],e=e[1];t!==r.windowId&&r.isOverlapping(n,e)&&r.emitIntersectionEvent(t,r.calculateIntersection(n,e))})}},{key:"isOverlapping",value:function(e,t){return!(t.position.x>=e.position.x+e.size.width||t.position.x+t.size.width<=e.position.x||t.position.y>=e.position.y+e.size.height||t.position.y+t.size.height<=e.position.y)}},{key:"calculateIntersection",value:function(e,t){var n=Math.max(e.position.x,t.position.x),r=Math.max(e.position.y,t.position.y);return{position:{x:n,y:r},size:{width:Math.min(e.position.x+e.size.width,t.position.x+t.size.width)-n,height:Math.min(e.position.y+e.size.height,t.position.y+t.size.height)-r}}}},{key:"emitIntersectionEvent",value:function(e,t){new BroadcastChannel("crosswindow_channel").postMessage({action:"intersecting",sourceWindowId:this.windowId,targetWindowId:e,intersectionArea:t})}}])&&a(e.prototype,t),r&&a(e,r),Object.defineProperty(e,"prototype",{writable:!1}),n}()},{}],6:[function(e,t,n){"use strict";function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!=o(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==o(e)?e:String(e)}(r.key),r)}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;n.default=function(){function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.cw=e,this.initEventListeners()}var e,n,r;return e=t,(n=[{key:"initEventListeners",value:function(){window.document.addEventListener("keydown",this.handleKeyboardEvent.bind(this)),window.document.addEventListener("keyup",this.handleKeyboardEvent.bind(this))}},{key:"handleKeyboardEvent",value:function(e){var t;!1!==e.bubbles&&(t={key:e.key,code:e.code,keyCode:e.keyCode,repeat:e.repeat,type:e.type,shiftKey:e.shiftKey,ctrlKey:e.ctrlKey,altKey:e.altKey,metaKey:e.metaKey,bubbles:!1},console.log("sending event keyevent",e.type),this.cw.communicationManager.sendMessage({targetWindowId:"any",action:e.type,message:t}))}}])&&i(e.prototype,n),r&&i(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}()},{}],7:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,s=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return s}}(e,t)||function(e,t){var n;if(e)return"string"==typeof e?o(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function i(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function s(r){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?i(Object(o),!0).forEach(function(e){var t,n;t=r,n=o[e=e],(e=c(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):i(Object(o)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(o,e))})}return r}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,c(r.key),r)}}function c(e){e=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==r(e)?e:String(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;n.default=function(){function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.config=e.config,this.windowId=e.windowId,this.emit=e.emit.bind(e),this.currentWindows={}}var e,n,r;return e=t,(n=[{key:"getCurrentWindows",value:function(){var t=this,n={};return Object.keys(this.currentWindows).forEach(function(e){t.currentWindows[e]&&(n[e]=t.currentWindows[e])}),n}},{key:"getWindows",value:function(){return JSON.parse(localStorage.getItem(this.config.metadataKey))||{}}},{key:"startHeartbeat",value:function(){var e=this;setInterval(function(){e.updateWindowMetadata(),e.removeInactiveWindows(200)},200)}},{key:"pollWindows",value:function(){var o=this,i=this.getWindows();setInterval(function(){var r=o.getWindows();Object.keys(i).forEach(function(e){e===o.windowId||r.hasOwnProperty(e)||o.emit("windowClosed",{windowId:e,metadata:i[e]})}),Object.keys(r).forEach(function(e){var t=r[e],n=i[e];n||o.emit("windowOpened",{windowId:e,metadata:t}),n&&o.hasMetadataChanged(n,t)&&o.emit("windowChanged",{windowId:e,metadata:t}),i[e]=t,o.currentWindows[e]=t}),i=s({},r)},15)}},{key:"hasMetadataChanged",value:function(e,t){return e.position.x!==t.position.x||e.position.y!==t.position.y||e.size.width!==t.size.width||e.size.height!==t.size.height}},{key:"getWindowMetadata",value:function(){return{position:{x:window.screenX,y:window.screenY},size:{width:window.outerWidth,height:window.outerHeight}}}},{key:"updateWindowMetadata",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.getWindowMetadata(),t=JSON.parse(localStorage.getItem(this.config.metadataKey))||{};t[this.windowId]=s(s({},e),{},{lastActive:Date.now()}),localStorage.setItem(this.config.metadataKey,JSON.stringify(t))}},{key:"removeInactiveWindows",value:function(){var n=this,r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1e3,o=JSON.parse(localStorage.getItem(this.config.metadataKey))||{},i=Date.now();Object.entries(o).forEach(function(e){var e=a(e,2),t=e[0],e=e[1];i-e.lastActive>r&&(delete o[t],n.currentWindows[t]=null)}),localStorage.setItem(this.config.metadataKey,JSON.stringify(o))}},{key:"markWindowAsActive",value:function(e){var t=JSON.parse(localStorage.getItem(this.config.metadataKey))||{};t[e]&&(t[e].lastActive=Date.now(),localStorage.setItem(this.config.metadataKey,JSON.stringify(t)))}},{key:"deregisterWindow",value:function(){var e=JSON.parse(localStorage.getItem(this.config.metadataKey))||{};delete e[this.windowId],localStorage.setItem(this.config.metadataKey,JSON.stringify(e))}}])&&u(e.prototype,n),r&&u(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}()},{}],8:[function(e,t,n){"use strict";function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!=o(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==o(e)?e:String(e)}(r.key),r)}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;n.default=function(){function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.cw=e,this.initEventListeners()}var e,n,r;return e=t,(n=[{key:"initEventListeners",value:function(){var t=this;["click","mousedown","mouseup","mousemove"].forEach(function(e){window.document.addEventListener(e,t.handleMouseEvent.bind(t))})}},{key:"handleMouseEvent",value:function(e){!1!==e.bubbles&&this.shouldBroadcastEvent(e)&&(e={type:e.type,x:e.clientX,y:e.clientY,button:e.button,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,altKey:e.altKey,metaKey:e.metaKey},this.cw.communicationManager.sendMessage({targetWindowId:"any",action:"mouseEvent",message:e}))}},{key:"shouldBroadcastEvent",value:function(e){return!0}}])&&i(e.prototype,n),r&&i(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}()},{}],9:[function(e,t,n){"use strict";function y(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,s=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return s}}(e,t)||function(e,t){var n;if(e)return"string"==typeof e?r(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function w(e,t,n){var r=(JSON.parse(localStorage.getItem("windowMetadata"))||{})[n];if(r){var o=r.size,i=(r.position,o.width/2),a=o.height/2;screenX,screenY;switch(e){case"E":case"NE":case"SE":t.x=-i/2+100;break;case"W":case"SW":case"NW":t.x=i/2-100;break;case"N":t.y=a/2-100;break;case"S":t.y=-a/2+100}return t}console.error("calculateEntryPosition: bestWindowMetadata not found for windowId",n)}function h(e,t,n,r,o){var i;switch(e){case"E":i=t.x-(r.x+o.width);break;case"W":i=r.x-(t.x+n.width);break;case"N":i=r.y-(t.y+n.height);break;case"S":i=t.y-(r.y+o.height);break;default:i=1/0}return i}Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){var r,o,i,a,s,u,n,c,l,d=this,f=function(e){var t=window.innerWidth/2,n=window.innerHeight/2,r=Math.abs(e.x-t),o=Math.abs(e.y-n);return o<r?e.x<t?"W":"E":e.y<n?"N":"S"}(e.screenPosition),t=JSON.parse(localStorage.getItem(this.config.metadataKey))||{};if(0!==Object.keys(t).length)return r={x:window.screenX,y:window.screenY},o={width:window.innerWidth,height:window.innerHeight},s=i=null,u=a=1/0,Object.entries(t).forEach(function(e){var t,e=y(e,2),n=e[0],e=e[1];n!==d.windowId&&(t=h(f,e.position,e.size,r,o),"E"===f&&e.position.x>r.x||"W"===f&&e.position.x<r.x||"N"===f&&e.position.y<r.y?t<a&&(a=t,i=n):"S"===f&&e.position.y>r.y&&t<a&&(a=t,i=n),t<u)&&(u=t,s=n)}),(i=(i=!i&&s?s:i)||this.windowId)===this.windowId&&1<Object.keys(t).length&&(delete t[this.windowId],a=1/0,Object.entries(t).forEach(function(e){var e=y(e,2),t=e[0],e=e[1],e=h(f,e.position,e.size,r,o);e<a&&(a=e,i=t)})),n=this,{windowId:c=i,direction:l=f,entryPosition:w(l,e.position,c),postMessage:function(e){var t=w(l,e.position,c);e.position=t,e.direction=l,e.targetWindowId=c,n.communicationManager.sendMessage(e)}};game.flashMessage("no other windows found")}},{}],10:[function(e,t,n){"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function s(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function u(r){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?s(Object(o),!0).forEach(function(e){var t,n;t=r,n=o[e=e],(e=function(e){e=function(e,t){if("object"!=i(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==i(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):s(Object(o)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(o,e))})}return r}Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];if(e){var r=screen.availWidth-window.screenX,o=screen.availHeight-window.screenY,r=u(u({},{width:Math.min(window.outerWidth,r-100),height:Math.min(window.outerHeight,o-100),menubar:"no",toolbar:"no",location:"no",status:"no",scrollbars:"yes",resizable:"yes",title:(new Date).toISOString(),left:window.screenX+window.outerWidth+100,top:window.screenY}),t),t=(n&&(r.left+r.width>screen.availWidth||r.top+r.height>screen.availHeight)&&(o=Math.floor(window.outerWidth/2),t=Math.floor(window.outerHeight/2),n=window.screenX+o+r.width>screen.availWidth?screen.availWidth-r.width-o:window.screenX,window.screenY+t+r.height>screen.availHeight?(screen.availHeight,r.height):window.screenY,r.width=o,r.height=t,r.left=n+o),Object.entries(r).map(function(e){t=2;var e=function(e){if(Array.isArray(e))return e}(e=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,s=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return s}}(e,t)||function(e,t){var n;if(e)return"string"==typeof e?a(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),t=e[0],e=e[1];return"".concat(t,"=").concat(e)}).join(",")),n=window.open(e,r.title,t);if(n)return n;console.error("Failed to open a new window. Please check browser popup settings.")}else console.error("URL is required to open a new window.")}},{}]},{},[1])(1)});
//# sourceMappingURL=crosswindow.min.js.map