!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).CW=e()}(function(){return function o(r,i,a){function s(t,e){if(!i[t]){if(!r[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(c)return c(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}n=i[t]={exports:{}},r[t][0].call(n.exports,function(e){return s(r[t][1][e]||e)},n,n.exports,o,r,i,a)}return i[t].exports}for(var c="function"==typeof require&&require,e=0;e<a.length;e++)s(a[e]);return s}({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"CrossWindow",{enumerable:!0,get:function(){return o.default}}),n.createCrossWindow=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new o.default(e)};var o=(n=e("./lib/CrossWindow.js"))&&n.__esModule?n:{default:n}},{"./lib/CrossWindow.js":3}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i=(e=e("./EventReceiver.js"))&&e.__esModule?e:{default:e};function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==r(e)?e:String(e)}(o.key),o)}}n.default=function(){function r(e,t,n,o){if(!(this instanceof r))throw new TypeError("Cannot call a class as a function");this.channel=e,this.windowId=t.windowId,this.cw=t,this.metadataManager=o,this.eventReceiver=new i.default(t),this.setupListeners(),this.startPing()}var e,t,n;return e=r,(t=[{key:"setupListeners",value:function(){var n=this;this.channel.onmessage=function(e){var t=e.data;switch(t.action){case"ping":t.sourceWindowId!==n.windowId&&n.channel.postMessage({action:"pong",sourceWindowId:n.windowId});break;case"pong":t.sourceWindowId!==n.windowId&&n.metadataManager.markWindowAsActive(t.sourceWindowId);break;case"message":"any"===t.targetWindowId&&n.cw.emit("message",t),t.targetWindowId===n.windowId&&n.cw.emit("message",t);break;case"intersecting":t.sourceWindowId!==n.windowId&&n.cw.emit("intersecting",t);break;case"keydown":case"keyup":t.sourceWindowId!==n.windowId&&(n.eventReceiver.handleKeyboardEvent(t),n.cw.emit("keyEvent",t));break;case"mouseEvent":n.eventReceiver.handleMouseEvent(t),n.cw.emit("mouseEvent",t)}}}},{key:"startPing",value:function(){var e=this;setInterval(function(){e.channel.postMessage({action:"ping",sourceWindowId:e.windowId})},1e3)}},{key:"sendMessage",value:function(e){e.targetWindowId===this.windowId?this.cw.emit("message",{sourceWindowId:this.windowId,payload:e}):((e=JSON.parse(JSON.stringify(e))).sourceWindowId=this.windowId,this.channel.postMessage(e))}}])&&o(e.prototype,t),n&&o(e,n),Object.defineProperty(e,"prototype",{writable:!1}),r}()},{"./EventReceiver.js":4}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i=o(e("./getBestWindow.js")),a=o(e("./open.js")),s=o(e("./CommunicationManager.js")),c=o(e("./MetadataManager.js")),u=o(e("./IntersectionDetector.js")),l=o(e("./KeyboardEventBroadcaster.js")),d=o(e("./MouseEventBroadcaster.js"));function o(e){return e&&e.__esModule?e:{default:e}}function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==r(e)?e:String(e)}(o.key),o)}}n.default=function(){function r(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=this,o=r;if(!(n instanceof o))throw new TypeError("Cannot call a class as a function");this.window=e,this.config={},this.config.metadataKey=t.metadataKey||"windowMetadata",this.config.broadcastKeyboardEvents=!0,this.config.broadcastMouseEvents=!0,"boolean"==typeof t.broadcastKeyboardEvents&&(this.config.broadcastKeyboardEvents=t.broadcastKeyboardEvents),"boolean"==typeof t.broadcastMouseEvents&&(this.config.broadcastMouseEvents=t.broadcastMouseEvents),this.events={},this.windowId="".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),this.metadataManager=new c.default(this),this.communicationManager=new s.default(new BroadcastChannel("crosswindow_channel"),this,null,this.metadataManager),this.intersectionDetector=new u.default(this.metadataManager,this.windowId),this.config.broadcastKeyboardEvents&&(this.keyboardEventBroadcaster=new l.default(this)),this.config.broadcastMouseEvents&&(this.mouseEventBroadcaster=new d.default(this)),this.open=a.default.bind(this),this.getBestWindow=i.default.bind(this),this.getWindows=this.metadataManager.getWindows.bind(this.metadataManager),this.getWindowById=this.metadataManager.getWindowById.bind(this.metadataManager),this.getCurrentWindows=this.metadataManager.getCurrentWindows.bind(this.metadataManager),this.getWindowMetadata=this.metadataManager.getWindowMetadata.bind(this),this.pollWindows=this.metadataManager.pollWindows.bind(this.metadataManager),this.postMessage=this.communicationManager.sendMessage.bind(this.communicationManager),this.registerWindow(),this.pollWindows(),this.metadataManager.startHeartbeat()}var e,t,n;return e=r,(t=[{key:"on",value:function(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t)}},{key:"emit",value:function(e,t){e=this.events[e];e&&e.forEach(function(e){return e(t)})}},{key:"registerWindow",value:function(){this.metadataManager.updateWindowMetadata(),this.pingOtherWindows()}},{key:"pingOtherWindows",value:function(){var e=this;new BroadcastChannel("crosswindow_channel").postMessage({action:"ping",sourceWindowId:this.windowId}),setTimeout(function(){return e.metadataManager.removeInactiveWindows()},100)}},{key:"deregisterWindow",value:function(){this.metadataManager.deregisterWindow()}}])&&f(e.prototype,t),n&&f(e,n),Object.defineProperty(e,"prototype",{writable:!1}),r}()},{"./CommunicationManager.js":2,"./IntersectionDetector.js":5,"./KeyboardEventBroadcaster.js":6,"./MetadataManager.js":7,"./MouseEventBroadcaster.js":8,"./getBestWindow.js":9,"./open.js":10}],4:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==r(e)?e:String(e)}(o.key),o)}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;n.default=function(){function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.crosswindow=e}var e,n,o;return e=t,(n=[{key:"handleKeyboardEvent",value:function(e){e.sourceWindowId!==this.crosswindow.windowId&&(e=new KeyboardEvent(e.action,{code:e.message.code,repeat:e.message.repeat,shiftKey:e.message.shiftKey,ctrlKey:e.message.ctrlKey,altKey:e.message.altKey,metaKey:e.message.metaKey,bubbles:!1}),document.dispatchEvent(e))}},{key:"handleMouseEvent",value:function(e){e.sourceWindowId!==this.crosswindow.windowId&&(e=new MouseEvent(e.message.type,{clientX:e.message.x,clientY:e.message.y,button:e.message.button,ctrlKey:e.message.ctrlKey,shiftKey:e.message.shiftKey,altKey:e.message.altKey,metaKey:e.message.metaKey,bubbles:!1}),document.dispatchEvent(e))}}])&&i(e.prototype,n),o&&i(e,o),Object.defineProperty(e,"prototype",{writable:!1}),t}()},{}],5:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,i,a,s=[],c=!0,u=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(o=i.call(n)).done)&&(s.push(o.value),s.length!==t);c=!0);}catch(e){u=!0,r=e}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw r}}return s}}(e,t)||function(e,t){var n;if(e)return"string"==typeof e?o(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function a(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==r(e)?e:String(e)}(o.key),o)}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;n.default=function(){function n(e,t){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");this.metadataManager=e,this.windowId=t,this.prevMetadata=null,this.startMetadataPolling()}var e,t,o;return e=n,(t=[{key:"startMetadataPolling",value:function(){var t=this;this.prevMetadata=this.metadataManager.getWindowMetadata(),setInterval(function(){var e=t.metadataManager.getWindowMetadata();t.metadataManager.hasMetadataChanged(t.prevMetadata,e)&&(t.metadataManager.updateWindowMetadata(e),t.checkForIntersections(e))},100)}},{key:"checkForIntersections",value:function(n){var o=this,e=JSON.parse(localStorage.getItem(this.metadataManager.metadataKey))||{};Object.entries(e).forEach(function(e){var e=i(e,2),t=e[0],e=e[1];t!==o.windowId&&o.isOverlapping(n,e)&&o.emitIntersectionEvent(t,o.calculateIntersection(n,e))})}},{key:"isOverlapping",value:function(e,t){return!(t.position.x>=e.position.x+e.size.width||t.position.x+t.size.width<=e.position.x||t.position.y>=e.position.y+e.size.height||t.position.y+t.size.height<=e.position.y)}},{key:"calculateIntersection",value:function(e,t){var n=Math.max(e.position.x,t.position.x),o=Math.max(e.position.y,t.position.y);return{position:{x:n,y:o},size:{width:Math.min(e.position.x+e.size.width,t.position.x+t.size.width)-n,height:Math.min(e.position.y+e.size.height,t.position.y+t.size.height)-o}}}},{key:"emitIntersectionEvent",value:function(e,t){new BroadcastChannel("crosswindow_channel").postMessage({action:"intersecting",sourceWindowId:this.windowId,targetWindowId:e,intersectionArea:t})}}])&&a(e.prototype,t),o&&a(e,o),Object.defineProperty(e,"prototype",{writable:!1}),n}()},{}],6:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==r(e)?e:String(e)}(o.key),o)}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;n.default=function(){function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.cw=e,this.initEventListeners()}var e,n,o;return e=t,(n=[{key:"initEventListeners",value:function(){window.document.addEventListener("keydown",this.handleKeyboardEvent.bind(this)),window.document.addEventListener("keyup",this.handleKeyboardEvent.bind(this))}},{key:"handleKeyboardEvent",value:function(e){var t;!1!==e.bubbles&&(t={key:e.key,code:e.code,keyCode:e.keyCode,repeat:e.repeat,type:e.type,shiftKey:e.shiftKey,ctrlKey:e.ctrlKey,altKey:e.altKey,metaKey:e.metaKey,bubbles:!1},this.cw.communicationManager.sendMessage({targetWindowId:"any",action:e.type,message:t}))}}])&&i(e.prototype,n),o&&i(e,o),Object.defineProperty(e,"prototype",{writable:!1}),t}()},{}],7:[function(e,t,n){"use strict";function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,i,a,s=[],c=!0,u=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(o=i.call(n)).done)&&(s.push(o.value),s.length!==t);c=!0);}catch(e){u=!0,r=e}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw r}}return s}}(e,t)||function(e,t){var n;if(e)return"string"==typeof e?r(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function i(t,e){var n,o=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,n)),o}function s(o){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?i(Object(r),!0).forEach(function(e){var t,n;t=o,n=r[e=e],(e=u(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach(function(e){Object.defineProperty(o,e,Object.getOwnPropertyDescriptor(r,e))})}return o}function c(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,u(o.key),o)}}function u(e){e=function(e,t){if("object"!=o(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==o(e)?e:String(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;n.default=function(){function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.cw=e,this.config=e.config,this.windowId=e.windowId,this.emit=e.emit.bind(e),this.currentWindows={}}var e,n,o;return e=t,(n=[{key:"getCurrentWindows",value:function(){var t=this,n={};return Object.keys(this.currentWindows).forEach(function(e){t.currentWindows[e]&&(n[e]=t.currentWindows[e])}),n}},{key:"createWindowObject",value:function(t,e){var n=this,o={postMessage:function(e){e.targetWindowId=t,e.sourceWindowId=n.cw.windowId,e.action="message",n.cw.communicationManager.sendMessage(e)}};return o.windowId=t,o.metadata=e,o}},{key:"getWindows",value:function(){var o=this,r=JSON.parse(localStorage.getItem(this.config.metadataKey))||{};return Object.keys(r).reduce(function(e,t){var n=r[t],t=o.createWindowObject(t,n);return e[t.windowId]=t,e},{})}},{key:"getWindowById",value:function(e){var t=(JSON.parse(localStorage.getItem(this.config.metadataKey))||{})[e];return t?this.createWindowObject(e,t):(console.log("Window with ID ".concat(e," not found.")),null)}},{key:"startHeartbeat",value:function(){var e=this;setInterval(function(){e.updateWindowMetadata(),e.removeInactiveWindows(200)},200)}},{key:"pollWindows",value:function(){var i=this,a=this.getWindows();setInterval(function(){var r=i.getWindows();Object.keys(a).forEach(function(e){e===i.windowId||r.hasOwnProperty(e)||i.emit("windowClosed",{windowId:e,metadata:a[e]})}),Object.keys(r).forEach(function(t){var e,n=r[t],o=a[t];o||((e={postMessage:function(e){e.targetWindowId=t,console.log("sending meta",e),e.action="message",i.cw.communicationManager.sendMessage(e)}}).windowId=t,e.metadata=n.metadata,i.emit("windowOpened",e)),o&&i.hasMetadataChanged(o.metadata,n.metadata)&&i.emit("windowChanged",n),a[t]=n,i.currentWindows[t]=n}),a=s({},r)},15)}},{key:"hasMetadataChanged",value:function(e,t){return e.position.x!==t.position.x||e.position.y!==t.position.y||e.size.width!==t.size.width||e.size.height!==t.size.height}},{key:"getWindowMetadata",value:function(){return{position:{x:window.screenX,y:window.screenY},size:{width:window.outerWidth,height:window.outerHeight}}}},{key:"updateWindowMetadata",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.getWindowMetadata(),t=JSON.parse(localStorage.getItem(this.config.metadataKey))||{};t[this.windowId]=s(s({},e),{},{lastActive:Date.now()}),localStorage.setItem(this.config.metadataKey,JSON.stringify(t))}},{key:"removeInactiveWindows",value:function(){var n=this,o=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1e3,r=JSON.parse(localStorage.getItem(this.config.metadataKey))||{},i=Date.now();Object.entries(r).forEach(function(e){var e=a(e,2),t=e[0],e=e[1];i-e.lastActive>o&&(delete r[t],n.currentWindows[t]=null)}),localStorage.setItem(this.config.metadataKey,JSON.stringify(r))}},{key:"markWindowAsActive",value:function(e){var t=JSON.parse(localStorage.getItem(this.config.metadataKey))||{};t[e]&&(t[e].lastActive=Date.now(),localStorage.setItem(this.config.metadataKey,JSON.stringify(t)))}},{key:"deregisterWindow",value:function(){var e=JSON.parse(localStorage.getItem(this.config.metadataKey))||{};delete e[this.windowId],localStorage.setItem(this.config.metadataKey,JSON.stringify(e))}}])&&c(e.prototype,n),o&&c(e,o),Object.defineProperty(e,"prototype",{writable:!1}),t}()},{}],8:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==r(e)?e:String(e)}(o.key),o)}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;n.default=function(){function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.cw=e,this.initEventListeners()}var e,n,o;return e=t,(n=[{key:"initEventListeners",value:function(){var t=this;["click","mousedown","mouseup","mousemove"].forEach(function(e){window.document.addEventListener(e,t.handleMouseEvent.bind(t))})}},{key:"handleMouseEvent",value:function(e){!1!==e.bubbles&&this.shouldBroadcastEvent(e)&&(e={type:e.type,x:e.clientX,y:e.clientY,button:e.button,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,altKey:e.altKey,metaKey:e.metaKey},this.cw.communicationManager.sendMessage({targetWindowId:"any",action:"mouseEvent",message:e}))}},{key:"shouldBroadcastEvent",value:function(e){return!0}}])&&i(e.prototype,n),o&&i(e,o),Object.defineProperty(e,"prototype",{writable:!1}),t}()},{}],9:[function(e,t,n){"use strict";function d(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,i,a,s=[],c=!0,u=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(o=i.call(n)).done)&&(s.push(o.value),s.length!==t);c=!0);}catch(e){u=!0,r=e}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw r}}return s}}(e,t)||function(e,t){var n;if(e)return"string"==typeof e?o(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function f(e,t,n,o){var o=3<arguments.length&&void 0!==o?o:1,r=(JSON.parse(localStorage.getItem("windowMetadata"))||{})[n];if(r){var i=r.size,a=(r.position,i.width/2),s=i.height/2;a*=o,s*=o;switch(e){case"E":case"NE":case"SE":t.x=-a/2+44;break;case"W":case"SW":case"NW":t.x=a/2-44;break;case"N":t.y=s/2-44;break;case"S":t.y=-s/2+44}return t}console.error("calculateEntryPosition: bestWindowMetadata not found for windowId",n)}function y(e,t,n,o,r){var i;switch(e){case"E":i=t.x-(o.x+r.width);break;case"W":i=o.x-(t.x+n.width);break;case"N":i=o.y-(t.y+n.height);break;case"S":i=t.y-(o.y+r.height);break;default:i=1/0}return i}Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){var o,r,i,a,s,c,u=this,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,l=function(e){var t=e.screenPosition,n=window.outerWidth/2,o=window.outerWidth/2,r=Math.abs(t.x-n),i=Math.abs(t.y-o);return i<r?e.velocity&&.1<e.velocity.y?"S":e.velocity&&e.velocity.y<-.1?"N":t.x<n?"W":"E":e.velocity&&.1<e.velocity.x?"E":e.velocity&&e.velocity.x<-.1?"W":t.y<o?"N":"S"}(e),n=JSON.parse(localStorage.getItem(this.config.metadataKey))||{};if(0!==Object.keys(n).length)return o={x:window.screenX,y:window.screenY},r={width:window.innerWidth,height:window.innerHeight},s=i=null,c=a=1/0,Object.entries(n).forEach(function(e){var t,e=d(e,2),n=e[0],e=e[1];n!==u.windowId&&(t=y(l,e.position,e.size,o,r),"E"===l&&e.position.x>o.x||"W"===l&&e.position.x<o.x||"N"===l&&e.position.y<o.y?t<a&&(a=t,i=n):"S"===l&&e.position.y>o.y&&t<a&&(a=t,i=n),t<c)&&(c=t,s=n)}),(i=(i=!i&&s?s:i)||this.windowId)===this.windowId&&1<Object.keys(n).length&&(delete n[this.windowId],a=1/0,Object.entries(n).forEach(function(e){var e=d(e,2),t=e[0],e=e[1],e=y(l,e.position,e.size,o,r);e<a&&(a=e,i=t)})),function(n,o,r,e){var i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:1;return{windowId:o,direction:r,entryPosition:f(r,e.position,o,i),postMessage:function(e){var t=f(r,e.position,o,i);e.position=t,e.direction=r,e.targetWindowId=o,n.communicationManager.sendMessage(e)}}}(this,i,l,e,t);game.flashMessage("no other windows found")}},{}],10:[function(e,t,n){"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function s(t,e){var n,o=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,n)),o}function c(o){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?s(Object(r),!0).forEach(function(e){var t,n;t=o,n=r[e=e],(e=function(e){e=function(e,t){if("object"!=i(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==i(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach(function(e){Object.defineProperty(o,e,Object.getOwnPropertyDescriptor(r,e))})}return o}Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];if(e){var o=screen.availWidth-window.screenX,r=screen.availHeight-window.screenY,o=c(c({},{width:Math.min(window.outerWidth,o-100),height:Math.min(window.outerHeight,r-100),menubar:"no",toolbar:"no",location:"no",status:"no",scrollbars:"yes",resizable:"yes",title:(new Date).toISOString(),left:window.screenX+window.outerWidth+100,top:window.screenY}),t),t=(n&&(o.left+o.width>screen.availWidth||o.top+o.height>screen.availHeight)&&(r=Math.floor(window.outerWidth/2),t=Math.floor(window.outerHeight/2),n=window.screenX+r+o.width>screen.availWidth?screen.availWidth-o.width-r:window.screenX,window.screenY+t+o.height>screen.availHeight?(screen.availHeight,o.height):window.screenY,o.width=r,o.height=t,o.left=n+r),Object.entries(o).map(function(e){t=2;var e=function(e){if(Array.isArray(e))return e}(e=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,i,a,s=[],c=!0,u=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(o=i.call(n)).done)&&(s.push(o.value),s.length!==t);c=!0);}catch(e){u=!0,r=e}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw r}}return s}}(e,t)||function(e,t){var n;if(e)return"string"==typeof e?a(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),t=e[0],e=e[1];return"".concat(t,"=").concat(e)}).join(",")),n=window.open(e,o.title,t);if(n)return n;console.error("Failed to open a new window. Please check browser popup settings.")}else console.error("URL is required to open a new window.")}},{}]},{},[1])(1)});
//# sourceMappingURL=crosswindow.min.js.map